<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
    <!DOCTYPE html>
    <TITLE>Create xml</TITLE>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div>
<script src="jquery-3.2.1.min.js">
</script>

<div id="navigation" STYLE="background:Lavender; text-align: left; height:120px; width:50%; float: left;">
    <p>&nbsp</p>
    <h1 STYLE="right;font-size:24px;">&#8195;Add xml config </h1>
</div>
<DIV id="navigation"
     STYLE="background:Lavender; text-align: right; height:120px; width:48%; float: right;font-size:18px; padding-right: 2%;">
    <p>&nbsp</p>
    <nav><a href="/admin.html">BACK TO PARSER</a></nav>
</DIV>
<div id="" style="position:fixed;margin-left:55%;width:45%;top:130px;">
    <p style="position:relative; top:13%; right:1%;">
    <img src="img/Exmple.jpg" style="right:1%; width:auto; height:400px ">
    </p>
        <p style="position:relative; top:58%; right:1%;">
        <textarea rows="50" style="right:1%; width:100%;  height:400px " readonly>How to write limiter:
    You can write regex pattern to capture printout or use USER FRIENDLY limiter:
    To put one or more white spaces between key words write - ' ' (space)
    In regex = '\s+'
    To put one or more white spaces and none or unlimited times characters (any letters, write spaces or end of lines) write - ' /any/ '
    In regex = '[\s|\n][\s\S]*?'
    To use two limiters in one print out write - ' /or/ ' between limiters.
    In regex = '|'

    You should write as many key words as possible, to make your limiter precise for your print out and
    with how many end of lines in the end of printout (in regex = '\n{2,}')

    For example we'll use rxmfp print out:

    rxmfp:mo=rxotg-187,subord,faulty;

    RADIO X-CEIVER ADMINISTRATION
    MANAGED OBJECT FAULT INFORMATION

    MO                   BTSSWVER
    RXORX-187-0          ERA-G07-R37-V01

    RU  RUREVISION                           RUSERIALNO
     0

        RUPOSITION                           RULOGICALID


        RULOGICALIDEXT


    STATE  BLSTATE  INTERCNT  CONCNT  CONERRCNT  LASTFLT   LFREASON
    OPER            00000

    FAULT CODES CLASS 2A
      1   2   3   4

    END

    We can write simple limiter 'MO /any/ FAULT CODES CLASS 2A /any/ \n{2,}'
    it will work for this printout, but if we put two print outs with similar key words such as:

    rxbsp:mo=rxstf-200;

    RADIO X-CEIVER ADMINISTRATION BTS STATUS DATA

    MO               OPCOND  OPCONDMAP                      OMLSTAT  RSLSTAT
    RXSTF-200        NOP     04

                     OPCONDTXT
                     nope

                     BTSSWVER         SECTOR

                     IDENTITYTXT

                     SECTORIDTXT

                     BSCDATE          BSCTIME

                     BTSDATE          BTSTIME

                     NEGA  NEGO  BTSC  BSCC  CTSN

                     CNFG  BUND  BTSN  BSCN
                     0001

    END


    rxmfp:mo=rxotg-187,subord,faulty;

    RADIO X-CEIVER ADMINISTRATION
    MANAGED OBJECT FAULT INFORMATION

    MO                   BTSSWVER
    RXORX-187-0          ERA-G07-R37-V01

    RU  RUREVISION                           RUSERIALNO
     0

        RUPOSITION                           RULOGICALID


        RULOGICALIDEXT


    STATE  BLSTATE  INTERCNT  CONCNT  CONERRCNT  LASTFLT   LFREASON
    OPER            00000

    FAULT CODES CLASS 2A
      1   2   3   4

    END

    the program will work incorrectly, because this limiter will capture two printout as one.
    To solve this problem just add one key word to limiter:

    MO BTSSWVER /any/ FAULT CODES CLASS 2A /any/ \n{2,}

    PS. You shouldn’t write header in limiter, because when user put print out without header the program will not match.
    </textarea>
    </p>
</div>
<form id="fromNameToMo">
    <p>&nbsp</p>
    <p>Name of config file
        <br>
        <input type="text" id="nameFile" name="nameFile" value="" title="Only letter" spellcheck="false" style="width:50%"
               autofocus required placeholder="With out .xml. Only letters and numbers">
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">

        <!--<input type="text" style="min-width:50%" onkeydown="this.style.width = ((this.value.length + 1) * 8) + 'px';"> -->


    </p>
    <p>Header of the printout
        <br>
        <input type="text" name="Header" value="" style="width:50%"
               placeholder="Header for this type printouts">

        <!--<input type="text" style="min-width:50%" onkeydown="this.style.width = ((this.value.length + 1) * 8) + 'px';"> -->


    </p>
    <p>Pattern of regular expression for parsing
        <br>
        <input type="text" name="limiter"
               value=""
               style="min-width:50%; max-width:100%;" onkeydown="this.style.width = ((this.value.length) * 8) + 'px';"
               placeholder="Regular expression for parsing. Example: MO FAULT CODES CLASS 2A \n{2,}" required>
    </p>

    <p>Name of managed object
        <br>
        <input type="text" name="name_key" value="" title="Letters and "
               placeholder="Managed object. Example {MO NSEI}"
               style="width:50%" required>
    </p>
    <p>Releases for this printout
        <br>
        <input type="text" name="Releases" value="" title=""
               placeholder="Available releases :G13B, G14B, A53, A54, A55, A56, A57, A58"
               style="width:50%" required>
    </p>
    <p>Values for parsing
        <br>
        <input type="text" name="keys" value="" style="width:50%"
               pattern="([\d\w]+ ?)+[\d\w]$" placeholder="Insert searching keys if format {key1 key2 key3}" required>
    </p>


    <script type="text/javascript">

function generate_bit_map(form, keys,name){


name.disabled = true;
var str = keys.value;


var true_str = str.replace(/\s+/g, ' ');

if (true_str.substring(true_str.length-1,true_str.length) == ' '){
    true_str = true_str.slice(0, -1);
}

var arr = true_str.split(" ");
var i = 0;



for (i = 0; i <arr.length; i++){
var node = document.createTextNode(arr[i]);
var para = document.createElement("p");

var node1 = document.createTextNode("System of calculation of bitmap  \xa0\xa0 \xa0 \xa0 \xa0");
var node2 = document.createTextNode("System of calculation of this value  \xa0 \xa0");
var node3 = document.createTextNode("Direction of reading values  \xa0\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0");
var node4 = document.createTextNode("Key value indicating no error \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0");
var para1 = document.createElement("p");
var para2 = document.createElement("p");
var para3 = document.createElement("p");
var para4 = document.createElement("p");

var btndiv = document.createElement("div");
btndiv.id = arr[i];
document.getElementById("myDiv").appendChild(btndiv);

var in_type = document.createElement('input');
in_type.type = 'text';
in_type.value = ""
in_type.setAttribute("pattern","(2)|(16)|(10)|(str)");
in_type.setAttribute("style","width:25%");
in_type.setAttribute("title","Its can be: bin(insert 2), hex (insert 16), dec (insert 10) or str (insert str)");
in_type.setAttribute("placeholder","bin(insert 2), hex (insert 16), dec (insert 10) or str (insert str)");
in_type.setAttribute("maxlength","3");
in_type.name = 'in_type';

var out_type = document.createElement('input');
out_type.type = 'text';
out_type.value = ""
out_type.setAttribute("maxlength","3");
out_type.setAttribute("style","width:25%");
out_type.setAttribute("pattern","(2)|(16)|(10)|(str)");
out_type.setAttribute("title","Its can be: bin(insert 2), hex (insert 16), dec (insert 10) or str (insert str)");
out_type.setAttribute("placeholder","bin(insert 2), hex (insert 16), dec (insert 10) or str (insert str)");
out_type.name = 'out_type';

var direct = document.createElement('input');
direct.type = 'text';
direct.value = ""
direct.setAttribute("style","width:25%");
direct.setAttribute("pattern","(1)|(0)|(-1)");
direct.setAttribute("title","Its can be: add values up to down(insert 1), add values down to up(insert -1) or don't add (insert 0)");
direct.setAttribute("placeholder","add values up to down(insert 1), add down to up(insert -1) or don't add(0)");
direct.setAttribute("maxlength","2");
direct.name = 'direct';

var norm_val = document.createElement('input');
norm_val.type = 'text';
norm_val.value = "";
norm_val.setAttribute("style","width:25%");
norm_val.setAttribute("title","default value for this key. Example: 0 for bin bitmap");
norm_val.setAttribute("placeholder","default value for this key. Example: 0 for bin bitmap");
norm_val.setAttribute("maxlength","4");
norm_val.name = 'norm_val';

var btnbits = document.createElement('input');
btnbits.type = 'button';
btnbits.value = "Add bit to bit-map";
btnbits.name = arr[i];
btnbits.setAttribute("onclick","append(this.form, this.name)");

btndiv.appendChild(btnbits);
para1.appendChild(node);

para.appendChild(node1);
para.appendChild(out_type);

para2.appendChild(node2);
para2.appendChild(in_type);

para3.appendChild(node3);
para3.appendChild(direct);

para4.appendChild(node4);
para4.appendChild(norm_val);

document.getElementById("myDiv").appendChild(para1).appendChild(btndiv).appendChild(para).appendChild(para2).appendChild(para3).appendChild(para4);


}

}


    </script>

    <script type="text/javascript">
function append(form, name) {
    var btndiv = document.createElement("div");
    btndiv.id = 'divBtn';
    document.getElementById(name).appendChild(btndiv);

    var btn = document.createElement('input');
    btn.type = 'text';
    btn.name = name;
    btn.value = ""
    btn.size = 65;
    btn.setAttribute("placeholder","Insert bit in format {name, value, text}");
    btn.setAttribute("pattern","[a-zA-Z0-9]+ [0-9]{,3} .+");
    btndiv.appendChild(btn);

}

function a(obj) {
if (obj!=undefined) {
obj.disabled=true;
//obj.disabled=(!obj.disabled);
}
}

function onReceive(val){
    console.log("'" + val + "'");
    console.log("'" + "false\n" + "'");

    if (val === 'false\n'){
        myFunction()
    }
    else {
    alert(val)}


}

function send_data(){
    var a = $("#fromNameToMo").serialize();
    console.log(a);
//    $.post('cgi-bin/add_xml_config.py', a, onReceive)

    $("#fromNameToMo").submit();

}

$(document).ready
(
    function()
    {
        $('#fromNameToMo').submit
        (
            function(event)
            {

                var a = $("#fromNameToMo").serialize();
                console.log(a);
                $.post('cgi-bin/add_xml_config.py', a, onReceive);
                return false;
            }
        )
    }
)

function myFunction() {
    var txt;
    var nameOfFile = prompt("Please enter a new name of file:", "");
     $("#nameFile").val(nameOfFile);
     console.log(nameOfFile);
     //console.log(document.getElementById("nameFile"));
    if (nameOfFile !== null){
        send_data();
    }

}

</script>


    <form id="keys_bits" name="keys_bit" onload="readfile()">
        <table>
            <div id="myDiv">
                <input type="button" name=button1 value="Generate bit-map for keys"
                       onclick="generate_bit_map(this.form, keys, this.name);this.hidden=true;">

            </div>
        </table>
        <p>Additional values for parsing
            <br>
            <input type="text" name="KeysToPrint" style="width:50%" value=""
                   placeholder="By side key that you want to print">
            </br>


             <!--<input type="submit" value="Create xml config" formaction="/cgi-bin/add_xml_config.py" formmethod="post">-->


            <!--<input type="button" value="Create xml config" onclick="send_data()"/>-->
            <input type="submit" value="Create xml config" />
            <!--onclick="send_data()"-->
        </p>

    </form>
</form>
<!--var newWin = window.prompt("sometext","defaultText", "width=200,height=200");-->

<form>

    <p id="demo"></p>
</form>

</body>
</html>